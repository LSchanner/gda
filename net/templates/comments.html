$def with (ThisComments)

$ S = sessionmaker(bind=DB)()

<div class="comment-box">
  <div id="comment-listing">
    $for Comment in ThisComments:
      $ oferec = S.query(Offering).filter(Offering.id == Comment.offering_id).one()
      $ subj = S.query(Subject).filter(Subject.id == oferec.subject_id).one()
      <div>
        $if not Comment.anonymous:
          <b>$Comment.user.student.name</b>
          sobre <a class="black-link" href=""><b>$subj.code  $(oferec.semester.sem)s$(oferec.semester.year)</b></a>
        $else:
          <b>An√¥nimo</b>
        <br/>
        $Comment.text
        <br></br>
      </div>
  </div>

</div>
